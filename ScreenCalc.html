<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>振动筛工艺计算器 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f1f5f9; color: #334155; }
        .card { background: white; border-radius: 12px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 12px; border: 1px solid #e2e8f0; }
        .label { display: block; font-size: 0.8rem; font-weight: 600; color: #64748b; margin-bottom: 4px; }
        .input { width: 100%; padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.95rem; font-weight: 500; color: #0f172a; background: #f8fafc; transition: all 0.2s; }
        .input:focus { outline: none; border-color: #3b82f6; background: #fff; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        
        .result-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed #e2e8f0; }
        .result-row:last-child { border-bottom: none; }
        .res-label { font-size: 0.85rem; color: #64748b; }
        .res-val { font-weight: 700; color: #0f172a; }
        
        .section-title { font-size: 0.9rem; font-weight: 700; color: #1e293b; margin-bottom: 10px; padding-left: 8px; border-left: 4px solid #3b82f6; }
        .highlight { color: #2563eb; }
        .tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: #e0f2fe; color: #0369a1; font-weight: 600; margin-left: 4px; }
    </style>
</head>
<body class="p-3 max-w-md mx-auto">

    <div class="flex items-center justify-between mb-4">
        <div>
            <h1 class="text-lg font-bold text-slate-800">振动筛选型助手</h1>
            <p class="text-xs text-slate-500">依据选矿设计手册 V7.3</p>
        </div>
        <button onclick="calculate()" class="bg-blue-600 text-white px-3 py-1.5 rounded-lg text-sm font-bold shadow active:bg-blue-700">计算</button>
    </div>

    <!-- 1. 几何参数 -->
    <div class="card">
        <h2 class="section-title border-blue-500">1. 设备几何 (Geometry)</h2>
        <div class="grid grid-cols-2 gap-3 mb-3">
            <div>
                <label class="label">筛面宽度 B (m)</label>
                <input type="number" id="width" class="input" value="3.6" oninput="calculate()">
            </div>
            <div>
                <label class="label">筛面长度 L (m)</label>
                <input type="number" id="length" class="input" value="8.5" oninput="calculate()">
            </div>
        </div>
        <div>
            <label class="label">筛面层序 (Deck Factor)</label>
            <select id="deck" class="input select" onchange="calculate()">
                <option value="0.9">上层/单层 (Kd=0.9)</option>
                <option value="0.7" selected>第二层 (Kd=0.7)</option>
                <option value="0.6">第三层 (Kd=0.6)</option>
            </select>
        </div>
    </div>

    <!-- 2. 筛孔与定额 -->
    <div class="card">
        <h2 class="section-title border-indigo-500">2. 筛孔与定额 (Aperture & V)</h2>
        <div class="mb-3">
            <label class="label flex justify-between">
                <span>筛孔尺寸 S (mm)</span>
                <span id="v_preview" class="text-xs text-indigo-600 font-bold">V = -- m³/(m²·h)</span>
            </label>
            <input type="number" id="aperture" class="input" value="4.0" step="0.5" oninput="calculate()">
        </div>
        <p class="text-xs text-slate-400">* V值基于表7.3-2自动线性插值</p>
    </div>

    <!-- 3. 修正系数 -->
    <div class="card">
        <h2 class="section-title border-cyan-500">3. 工况修正 (Factors)</h2>
        
        <div class="mb-3">
            <label class="label">上游来料工况 (Feed Source)</label>
            <select id="feed_source" class="input select" onchange="calculate()">
                <option value="hpgr" selected>HPGR产品 (细粒多 K1=1.4)</option>
                <option value="cone">圆锥破产品 (标准 K1=1.0)</option>
                <option value="jaw">颚破/旋回 (粗粒多 K1=0.6)</option>
                <option value="ball">球磨排料 (极细 K1=1.6)</option>
            </select>
        </div>

        <div class="mb-3">
            <label class="label">筛面种类与孔形 (K8 - 表7.3-10)</label>
            <select id="media_k8" class="input select" onchange="calculate()">
                <option value="1.0">编织筛网 - 方形孔 (1.0)</option>
                <option value="1.2">编织筛网 - 长方孔 (1.2)</option>
                <option value="0.85">冲孔筛板 - 方形孔 (0.85)</option>
                <option value="0.70">冲孔筛板 - 圆形孔 (0.70)</option>
                <option value="0.90" selected>橡胶/PU - 方形孔 (0.90)</option>
                <option value="1.20">橡胶/PU - 条缝孔 (1.20)</option>
            </select>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div>
                <label class="label">筛分方法 (Kw)</label>
                <select id="method_kw" class="input select" onchange="calculate()">
                    <option value="1.4" selected>湿式 (1.4)</option>
                    <option value="1.0">干式 (1.0)</option>
                </select>
            </div>
            <div>
                <label class="label">堆比重 δ (t/m³)</label>
                <input type="number" id="density" class="input" value="1.88" step="0.01" oninput="calculate()">
            </div>
        </div>
    </div>

    <!-- 结果 -->
    <div class="card bg-slate-900 text-white border-none">
        <div class="text-xs text-slate-400 mb-1 uppercase tracking-wider font-bold">Calculated Capacity</div>
        <div class="flex items-baseline mb-4">
            <span id="res_mass" class="text-4xl font-bold text-green-400">0</span>
            <span class="text-lg ml-1 font-medium text-green-600">t/h</span>
        </div>

        <div class="bg-slate-800 rounded-lg p-3 space-y-2 text-sm">
            <div class="flex justify-between">
                <span class="text-slate-400">容积处理量</span>
                <span class="font-bold"><span id="res_vol">0</span> m³/h</span>
            </div>
            <div class="flex justify-between border-t border-slate-700 pt-2 mt-2">
                <span class="text-slate-400">有效透筛面积 <span class="text-xs text-slate-500">(BxLxKd)</span></span>
                <span class="font-bold text-yellow-400"><span id="res_area">0</span> m²</span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">单位定额 V</span>
                <span class="font-bold"><span id="res_v">0</span></span>
            </div>
            <div class="flex justify-between">
                <span class="text-slate-400">综合系数 ΠK</span>
                <span class="font-bold text-blue-400"><span id="res_k_total">0</span></span>
            </div>
        </div>
        
        <div class="mt-3 text-xs text-slate-500 text-center">
             K1·K2·Kw·K8 已计入综合系数
        </div>
    </div>

    <script>
        // 1. Data Tables
        // Table 7.3-2: Aperture (mm) -> Unit Capacity (m3/m2.h)
        const V_TABLE = [
            [0.15, 1.1], [0.2, 1.6], [0.3, 2.3], [0.5, 3.2], [0.8, 4.0],
            [1.0, 4.4], [2.0, 5.6], [3.0, 6.3], [4.0, 8.7], [5.0, 11.0],
            [6.0, 12.9], [8.0, 15.9], [10.0, 18.2], [12.0, 20.1],
            [14.0, 21.7], [16.0, 23.1], [20.0, 25.4], [25.0, 27.8],
            [30.0, 29.6], [40.0, 32.6], [50.0, 37.6], [60.0, 41.6],
            [80.0, 48.0], [100.0, 53.0]
        ];

        // Feed Conditions (K1=Fines, K2=Oversize)
        const FEED_PRESETS = {
            'hpgr': { k1: 1.4, k2: 1.0 },
            'cone': { k1: 1.0, k2: 1.05 },
            'jaw':  { k1: 0.6, k2: 1.3 },
            'ball': { k1: 1.6, k2: 0.95 }
        };

        // 2. Helper Functions
        function interpolateV(s) {
            if (s <= V_TABLE[0][0]) return V_TABLE[0][1];
            if (s >= V_TABLE[V_TABLE.length-1][0]) return V_TABLE[V_TABLE.length-1][1];
            
            for (let i = 0; i < V_TABLE.length - 1; i++) {
                let x1 = V_TABLE[i][0], y1 = V_TABLE[i][1];
                let x2 = V_TABLE[i+1][0], y2 = V_TABLE[i+1][1];
                if (s >= x1 && s <= x2) {
                    return y1 + (s - x1) * (y2 - y1) / (x2 - x1);
                }
            }
            return 0;
        }

        function calculate() {
            // Inputs
            const B = parseFloat(document.getElementById('width').value) || 0;
            const L = parseFloat(document.getElementById('length').value) || 0;
            const Kd = parseFloat(document.getElementById('deck').value) || 1.0;
            
            const S = parseFloat(document.getElementById('aperture').value) || 0;
            
            const feedType = document.getElementById('feed_source').value;
            const K8 = parseFloat(document.getElementById('media_k8').value);
            const Kw = parseFloat(document.getElementById('method_kw').value);
            const delta = parseFloat(document.getElementById('density').value) || 1.0;

            // 1. Effective Area (Logic: B * L * Kd)
            const area_nominal = B * L;
            const area_effective = area_nominal * Kd;

            // 2. Unit Capacity V
            const V = interpolateV(S);
            
            // 3. Coefficients
            const k_feed = FEED_PRESETS[feedType];
            const K1 = k_feed.k1;
            const K2 = k_feed.k2;
            
            // Note: Kd is NOT in K_total because it's used in Area
            const K_total = Kw * K8 * K1 * K2;

            // 4. Final Calc
            // Q_vol = Area_Eff * V * K_modifiers
            const Q_vol = area_effective * V * K_total;
            const Q_mass = Q_vol * delta;

            // Updates
            document.getElementById('v_preview').innerText = `V ≈ ${V.toFixed(2)}`;
            
            document.getElementById('res_area').innerText = area_effective.toFixed(2);
            document.getElementById('res_v').innerText = V.toFixed(2);
            document.getElementById('res_k_total').innerText = K_total.toFixed(3);
            
            document.getElementById('res_vol').innerText = Math.round(Q_vol);
            document.getElementById('res_mass').innerText = Math.round(Q_mass);
        }

        // Init
        calculate();
    </script>
</body>
</html>